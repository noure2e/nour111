<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Future Twitter</title>
<style>
  body { background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); color: #fff; font-family: Arial, sans-serif; margin: 0; padding: 0; }
  header { text-align: center; padding: 20px; font-size: 2rem; background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); }
  .tweet-box { display: flex; justify-content: center; padding: 20px; }
  .tweet-box textarea { width: 60%; padding: 10px; border-radius: 10px; border: none; resize: none; font-size: 1rem; }
  .tweet-box button { padding: 10px 20px; margin-left: 10px; background: #1da1f2; border: none; border-radius: 10px; cursor: pointer; color: #fff; font-size: 1rem; }
  #tweets { max-width: 700px; margin: 0 auto; padding: 20px; }
  .tweet { background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); margin-bottom: 20px; padding: 15px; border-radius: 15px; }
  .tweet-header { display: flex; align-items: center; margin-bottom: 10px; cursor:pointer; }
  .tweet-header img { width: 50px; height: 50px; border-radius: 50%; margin-right: 10px; }
  .tweet-header h3 { margin: 0; font-size: 1.2rem; }
  .tweet-actions { display: flex; justify-content: space-around; margin-top: 10px; font-size: 0.9rem; }
  .tweet-actions span { cursor: pointer; }
  #profile { max-width: 500px; margin: 20px auto; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; display: none; }
  #profile img { width: 80px; height: 80px; border-radius: 50%; }
  #profile button { margin-top: 10px; padding: 5px 10px; background:#1da1f2; border:none; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>
<header>ğŸš€ Future Twitter</header>

<div class="tweet-box">
  <textarea id="tweetText" rows="3" placeholder="Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø«ØŸ"></textarea>
  <button onclick="addTweet()">Ù†Ø´Ø±</button>
</div>

<div id="tweets"></div>

<div id="profile">
  <img id="profileImg" src="">
  <h3 id="profileName"></h3>
  <p>Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª: <span id="tweetCount"></span></p>
  <p>Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙˆÙ†: <span id="followersCount"></span></p>
  <p>ÙŠØªØ§Ø¨Ø¹: <span id="followingCount"></span></p>
  <button id="followBtn" onclick="toggleFollow()">Ù…ØªØ§Ø¨Ø¹Ø©</button>
</div>

<!-- Firebase App + Firestore + Auth (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCUpbsaQUWMBEM5ckCU1enlx0p4y8gEGNE",
    authDomain: "future-twitter.firebaseapp.com",
    projectId: "future-twitter",
    storageBucket: "future-twitter.firebasestorage.app",
    messagingSenderId: "603335040034",
    appId: "1:603335040034:web:593019e8e8e80ed51e7e7b",
    measurementId: "G-V0MS908RXJ"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();
  const tweetsContainer = document.getElementById('tweets');

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google
  async function signIn() {
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
  }

  async function signOut() {
    await auth.signOut();
  }

  auth.onAuthStateChanged(user => {
    if(user) {
      document.querySelector('.tweet-box').style.display = 'flex';
    } else {
      document.querySelector('.tweet-box').style.display = 'none';
      tweetsContainer.innerHTML = '<p style="text-align:center;">ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.</p>';
    }
  });

  // Ø¥Ø¶Ø§ÙØ© ØªØºØ±ÙŠØ¯Ø©
  async function addTweet() {
    const tweetText = document.getElementById('tweetText').value.trim();
    if(tweetText === '') return;
    const user = auth.currentUser;
    if(!user) return alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');

    await db.collection('tweets').add({
      text: tweetText,
      time: Date.now(),
      userId: user.uid,
      username: user.displayName,
      photoURL: user.photoURL
    });

    const userRef = db.collection('users').doc(user.uid);
    userRef.update({ tweetCount: firebase.firestore.FieldValue.increment(1) });
    document.getElementById('tweetText').value = '';
  }

  // Ø¹Ø±Ø¶ Ø§Ù„ØªØºØ±ÙŠØ¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
  db.collection('tweets').orderBy('time','desc').onSnapshot(snapshot => {
    tweetsContainer.innerHTML = '';
    snapshot.forEach(doc => {
      const data = doc.data();
      const tweetDiv = document.createElement('div');
      tweetDiv.classList.add('tweet');
      tweetDiv.innerHTML = `
        <div class="tweet-header" onclick="loadProfile('${data.userId}')">
          <img src="${data.photoURL}" alt="Avatar">
          <h3>${data.username} <span>@${data.username.replace(/\s+/g,'').toLowerCase()}</span></h3>
        </div>
        <p>${data.text}</p>
        <div class="tweet-actions">
          <span>â¤ï¸ Ø¥Ø¹Ø¬Ø§Ø¨</span>
          <span>ğŸ’¬ ØªØ¹Ù„ÙŠÙ‚</span>
          <span>ğŸ” Ø¥Ø¹Ø§Ø¯Ø© ØªØºØ±ÙŠØ¯</span>
          <span>ğŸ”– Ø­ÙØ¸</span>
        </div>
      `;
      tweetsContainer.appendChild(tweetDiv);
    });
  });

  // Ù…Ù„Ù Ø´Ø®ØµÙŠ
  async function loadProfile(uid) {
    const profileDiv = document.getElementById('profile');
    const profileImg = document.getElementById('profileImg');
    const profileName = document.getElementById('profileName');
    const tweetCountEl = document.getElementById('tweetCount');
    const followersCountEl = document.getElementById('followersCount');
    const followingCountEl = document.getElementById('followingCount');
    const followBtn = document.getElementById('followBtn');

    const userDoc = await db.collection('users').doc(uid).get();
    if(!userDoc.exists) {
      await db.collection('users').doc(uid).set({
        tweetCount: 0,
        followersCount: Math.floor(Math.random()*1000),
        followingCount: Math.floor(Math.random()*300),
        followers: [],
        following: []
      });
    }
    const data = (await db.collection('users').doc(uid).get()).data();

    profileImg.src = data.photoURL || 'https://i.pravatar.cc/80';
    profileName.textContent = data.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…';
    tweetCountEl.textContent = data.tweetCount || 0;
    followersCountEl.textContent = data.followersCount || 0;
    followingCountEl.textContent = data.followingCount || 0;

    // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ù…ØªØ§Ø¨Ø¹Ø©/Ø¥Ù„ØºØ§Ø¡
    const currentUser = auth.currentUser;
    if(currentUser && currentUser.uid !== uid) {
      followBtn.style.display = 'block';
      followBtn.textContent = (data.followers && data.followers.includes(currentUser.uid)) ? 'Ø¥Ù„ØºØ§Ø¡ Ù…ØªØ§Ø¨Ø¹Ø©' : 'Ù…ØªØ§Ø¨Ø¹Ø©';
      followBtn.onclick = async () => {
        const userRef = db.collection('users').doc(uid);
        const currentRef = db.collection('users').doc(currentUser.uid);

        if(data.followers && data.followers.includes(currentUser.uid)) {
          await userRef.update({ followers: firebase.firestore.FieldValue.arrayRemove(currentUser.uid), followersCount: firebase.firestore.FieldValue.increment(-1) });
          await currentRef.update({ following: firebase.firestore.FieldValue.arrayRemove(uid), followingCount: firebase.firestore.FieldValue.increment(-1) });
          followBtn.textContent = 'Ù…ØªØ§Ø¨Ø¹Ø©';
        } else {
          await userRef.update({ followers: firebase.firestore.FieldValue.arrayUnion(currentUser.uid), followersCount: firebase.firestore.FieldValue.increment(1) });
          await currentRef.update({ following: firebase.firestore.FieldValue.arrayUnion(uid), followingCount: firebase.firestore.FieldValue.increment(1) });
          followBtn.textContent = 'Ø¥Ù„ØºØ§Ø¡ Ù…ØªØ§Ø¨Ø¹Ø©';
        }
      };
    } else {
      followBtn.style.display = 'none';
    }

    profileDiv.style.display = 'block';
  }
</script>
</body>
</html>
