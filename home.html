<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Future Twitter - ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</title>
<style>
body {
  margin: 0; padding: 0;
  font-family: Arial, sans-serif;
  background: #0f172a; color: #fff;
}
header {
  background: #1e293b; padding: 15px;
  display: flex; justify-content: space-between; align-items: center;
}
header h1 { margin:0; font-size: 24px; }
header button { padding: 8px 12px; border:none; border-radius:5px; background:#3b82f6; cursor:pointer; color:#fff; }

.container {
  max-width: 600px; margin: 20px auto;
}

.tweet-box, .tweet {
  background:#1e293b; padding:15px; border-radius:10px; margin-bottom:15px;
}

.tweet-box textarea {
  width:100%; padding:10px; border-radius:5px; border:none; resize:none;
}

.tweet-box input[type="file"] {
  margin-top:10px;
}

.tweet-box button { margin-top:10px; padding:10px; background:#3b82f6; color:#fff; border:none; border-radius:5px; cursor:pointer; }

.tweet img { max-width:100%; border-radius:10px; margin-top:10px; }

.actions {
  display:flex; gap:10px; margin-top:10px;
}

.actions button {
  flex:1; background:#334155; border:none; border-radius:5px; color:#fff; padding:8px; cursor:pointer;
}

.user-info {
  display:flex; align-items:center; gap:10px; margin-bottom:10px;
}

.user-info img { width:40px; height:40px; border-radius:50%; }

.comment-box { margin-top:10px; }
.comment-box input {
  width: calc(100% - 80px); padding:5px; border-radius:5px; border:none;
}
.comment-box button { padding:5px 10px; margin-left:5px; border:none; border-radius:5px; background:#3b82f6; color:#fff; cursor:pointer; }

.comments-list { margin-top:10px; font-size:14px; }
.comments-list div { margin-bottom:5px; background:#334155; padding:5px; border-radius:5px; }
</style>
</head>
<body>

<header>
  <h1>Future Twitter</h1>
  <button onclick="logout()">ÿÆÿ±Ÿàÿ¨</button>
</header>

<div class="container">
  <div class="tweet-box">
    <h3>ŸÖÿ±ÿ≠ÿ®ÿßŸã <span id="currentUser"></span></h3>
    <textarea id="tweetText" rows="3" placeholder="ÿßŸÉÿ™ÿ® ÿ™ÿ∫ÿ±ŸäÿØÿ™ŸÉ ŸáŸÜÿß..."></textarea>
    <input type="file" id="tweetImage" accept="image/*">
    <button onclick="postTweet()">ÿ∫ÿ±ÿØ</button>
  </div>

  <div id="tweets"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot, doc, updateDoc, increment, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyCUpbsaQUWMBEM5ckCU1enlx0p4y8gEGNE",
  authDomain: "future-twitter.firebaseapp.com",
  projectId: "future-twitter",
  storageBucket: "future-twitter.appspot.com",
  messagingSenderId: "603335040034",
  appId: "1:603335040034:web:301ad6536582c15e1e7e7b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

let currentUser = localStorage.getItem('username');
let avatar = localStorage.getItem('avatar') || '';

if(!currentUser) window.location.href = 'index.html';
document.getElementById('currentUser').textContent = currentUser;

window.logout = () => {
  localStorage.clear();
  window.location.href = 'index.html';
};

window.postTweet = async () => {
  const text = document.getElementById('tweetText').value.trim();
  const fileInput = document.getElementById('tweetImage');
  let imageUrl = '';

  if(fileInput.files[0]) {
    const file = fileInput.files[0];
    const storageRef = ref(storage, 'tweets/' + Date.now() + '_' + file.name);
    await uploadBytes(storageRef, file);
    imageUrl = await getDownloadURL(storageRef);
  }

  if(!text && !imageUrl) return alert('ÿßŸÉÿ™ÿ® ŸÜÿµ ÿ£Ÿà ÿ£ÿ∂ŸÅ ÿµŸàÿ±ÿ©');

  await addDoc(collection(db, "tweets"), {
    user: currentUser,
    avatar: avatar,
    text,
    image: imageUrl,
    timestamp: serverTimestamp(),
    likes: 0,
    retweets: 0,
    saves: 0,
    likedBy: [],
    retweetedBy: [],
    savedBy: [],
    comments: []
  });

  document.getElementById('tweetText').value = '';
  fileInput.value = '';
};

const tweetsContainer = document.getElementById('tweets');
const q = query(collection(db, "tweets"), orderBy("timestamp", "desc"));

onSnapshot(q, snapshot => {
  tweetsContainer.innerHTML = '';
  const fragment = document.createDocumentFragment();

  snapshot.forEach(docSnap => {
    const t = docSnap.data();
    const id = docSnap.id;

    const tweetDiv = document.createElement('div');
    tweetDiv.classList.add('tweet');

    tweetDiv.innerHTML = `
      <div class="user-info">
        <img src="${t.avatar || 'https://via.placeholder.com/40'}" alt="">
        <strong>${t.user}</strong>
      </div>
      <div>${t.text || ''}</div>
      ${t.image ? `<img src="${t.image}" alt="">` : ''}
      <div class="actions">
        <button onclick="likeTweet('${id}')">‚ù§Ô∏è ${t.likes}</button>
        <button onclick="retweetTweet('${id}')">üîÅ ${t.retweets}</button>
        <button onclick="saveTweet('${id}')">üîñ ${t.saves}</button>
      </div>
      <div class="comment-box">
        <input type="text" id="comment-${id}" placeholder="ÿ£ÿ∂ŸÅ ÿ™ÿπŸÑŸäŸÇÿßŸã...">
        <button onclick="addComment('${id}')">ÿ™ÿπŸÑŸäŸÇ</button>
      </div>
      <div class="comments-list" id="comments-${id}"></div>
    `;

    fragment.appendChild(tweetDiv);

    // ÿπÿ±ÿ∂ ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™
    const commentsList = tweetDiv.querySelector(`#comments-${id}`);
    if(t.comments) {
      t.comments.forEach(c => {
        const div = document.createElement('div');
        div.textContent = `${c.user}: ${c.text}`;
        commentsList.appendChild(div);
      });
    }
  });

  tweetsContainer.appendChild(fragment);
});

// ÿßŸÑÿ™ŸÅÿßÿπŸÑÿßÿ™
window.likeTweet = async (id) => {
  const tweetRef = doc(db, "tweets", id);
  const tweetSnap = await tweetRef.get();
  await updateDoc(tweetRef, { 
    likes: increment(1),
    likedBy: arrayUnion(currentUser)
  });
};

window.retweetTweet = async (id) => {
  const tweetRef = doc(db, "tweets", id);
  await updateDoc(tweetRef, {
    retweets: increment(1),
    retweetedBy: arrayUnion(currentUser)
  });
};

window.saveTweet = async (id) => {
  const tweetRef = doc(db, "tweets", id);
  await updateDoc(tweetRef, {
    saves: increment(1),
    savedBy: arrayUnion(currentUser)
  });
};

window.addComment = async (id) => {
  const input = document.getElementById(`comment-${id}`);
  const text = input.value.trim();
  if(!text) return;
  const tweetRef = doc(db, "tweets", id);
  await updateDoc(tweetRef, {
    comments: arrayUnion({ user: currentUser, text })
  });
  input.value = '';
};
</script>

</body>
</html>
